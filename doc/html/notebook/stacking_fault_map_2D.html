
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>stacking_fault_map_2D Calculation &#8212; iprPy 0.8.0 documentation</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="surface_energy Calculation" href="surface_energy_static.html" />
    <link rel="prev" title="relax_static Calculation" href="relax_static.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="surface_energy_static.html" title="surface_energy Calculation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="relax_static.html" title="relax_static Calculation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.8.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" accesskey="U">Jupyter Demonstration Notebooks</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="stacking_fault_map_2D-Calculation">
<h1>stacking_fault_map_2D Calculation<a class="headerlink" href="#stacking_fault_map_2D-Calculation" title="Permalink to this headline">¶</a></h1>
<p><strong>Lucas M. Hale</strong>,
<a class="reference external" href="mailto:lucas&#46;hale&#37;&#52;&#48;nist&#46;gov?Subject=ipr-demo">lucas<span>&#46;</span>hale<span>&#64;</span>nist<span>&#46;</span>gov</a>,
<em>Materials Science and Engineering Division, NIST</em>.</p>
<p><strong>Chandler A. Becker</strong>,
<a class="reference external" href="mailto:chandler&#46;becker&#37;&#52;&#48;nist&#46;gov?Subject=ipr-demo">chandler<span>&#46;</span>becker<span>&#64;</span>nist<span>&#46;</span>gov</a>,
<em>Office of Data and Informatics, NIST</em>.</p>
<p><strong>Zachary T. Trautt</strong>,
<a class="reference external" href="mailto:zachary&#46;trautt&#37;&#52;&#48;nist&#46;gov?Subject=ipr-demo">zachary<span>&#46;</span>trautt<span>&#64;</span>nist<span>&#46;</span>gov</a>,
<em>Materials Measurement Science Division, NIST</em>.</p>
<p>Version: 2018-06-24</p>
<p><a class="reference external" href="http://www.nist.gov/public_affairs/disclaimer.cfm">Disclaimers</a></p>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>The <strong>stacking_fault_map_2D</strong> calculation evaluates the full 2D
generalized stacking fault map for an array of shifts along a specified
crystallographic plane. A regular grid of points is established and the
generalized stacking fault energy is evaluated at each.</p>
<p><strong>Version notes</strong>: This was previously called the stacking_fault_multi
calculation and was renamed for clarity.</p>
<p><strong>Disclaimer #1</strong>: The system’s dimension perpendicular to the fault
plane should be large to minimize the interaction of the free surface
and the stacking fault.</p>
</div>
<div class="section" id="Method-and-Theory">
<h2>Method and Theory<a class="headerlink" href="#Method-and-Theory" title="Permalink to this headline">¶</a></h2>
<p>First, an initial system is generated. This is accomplished by</p>
<ol class="arabic simple">
<li>Starting with a unit cell system.</li>
<li>Generating a transformed system by rotating the unit cell such that
the new system’s box vectors correspond to crystallographic
directions, and filled in with atoms to remain a perfect bulk cell
when the three boundaries are periodic.</li>
<li>All atoms are shifted by a fractional amount of the box vectors if
needed.</li>
<li>A supercell system is constructed by combining multiple replicas of
the transformed system.</li>
</ol>
<p>The system is then cut by making one of the box boundaries non-periodic.
A limitation placed on the calculation is that the normal to the cut
plane must correspond to one of the three Cartesian (<span class="math">\(x\)</span>,
<span class="math">\(y\)</span>, or <span class="math">\(z\)</span>) axes. If true, then of the system’s three box
vectors (<span class="math">\(\vec{a}\)</span>, <span class="math">\(\vec{b}\)</span>, and <span class="math">\(\vec{c}\)</span>), two
will be parallel to the plane, and the third will not. The non-parallel
box vector is called the cutboxvector, and for LAMMPS compatible
systems, the following conditions can be used to check the system’s
compatibility:</p>
<ul class="simple">
<li>cutboxvector = ‘c’: all systems allowed.</li>
<li>cutboxvector = ‘b’: the system’s yz tilt must be zero.</li>
<li>cutboxvector = ‘a’: the system’s xy and xz tilts must be zero.</li>
</ul>
<p>A LAMMPS simulation performs an energy/force minimization on the system
where the atoms are confined to only relax along the Cartesian direction
normal to the cut plane.</p>
<p>A mathematical fault plane parallel to the cut plane is defined in the
middle of the system. A generalized stacking fault system can then be
created by shifting all atoms on one side of the fault plane by a
vector, <span class="math">\(\vec{s}\)</span>. The shifted system is then relaxed using the
same confined energy/force minimization used on the non-shifted system.
The generalized stacking fault energy, <span class="math">\(\gamma_{gsf}\)</span>, can then be
computed by comparing the total energy of the system, <span class="math">\(E^{total}\)</span>,
before and after <span class="math">\(\vec{s}\)</span> is applied</p>
<div class="math">
\[\gamma_{gsf}(\vec{s}) = \frac{E^{total}(\vec{s}) - E^{total}(\vec{0})}{A_{fault}},\]</div>
<p>where <span class="math">\(A_{fault}\)</span> is the area of the fault plane, which can be
computed using the two box vectors, <span class="math">\(\vec{a_1}\)</span> and
<span class="math">\(\vec{a_2}\)</span>, that are not the cutboxvector.</p>
<div class="math">
\[A_{fault} = \left| \vec{a_1} \times \vec{a_2} \right|,\]</div>
<p>Additionally, the relaxation normal to the glide plane is characterized
using the center of mass of the atoms above and below the cut plane.
Notably, the component of the center of mass normal to the glide/cut
plane is calculated for the two halves of the the system, and the
difference is computed</p>
<div class="math">
\[delta_{gsf} = \left&lt;x\right&gt;^{above} - \left&lt;x\right&gt;^{below}.\]</div>
<p>The relaxation normal is then taken as the change in the center of mass
difference after the shift is applied.</p>
<div class="math">
\[\Delta\delta_{gsf} = delta_{gsf}(\vec{s}) - delta_{gsf}(\vec{0}).\]</div>
<p>The stacking_fault_multi calculation evaluates both
<span class="math">\(\gamma_{gsf}\)</span> and <span class="math">\(\Delta\delta_{gsf}\)</span> for a complete 2D
grid of <span class="math">\(\vec{s}\)</span> values. The grid is built by taking fractional
steps along two vectors parallel to the shift plane.</p>
</div>
<div class="section" id="Demonstration">
<h2>Demonstration<a class="headerlink" href="#Demonstration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="1.-Library-imports">
<h3>1. Library imports<a class="headerlink" href="#1.-Library-imports" title="Permalink to this headline">¶</a></h3>
<p>Import libraries needed by the calculation. The external libraries used
are:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.numpy.org/">numpy</a></li>
<li><a class="reference external" href="https://pandas.pydata.org/">pandas</a></li>
<li><a class="reference external" href="https://github.com/usnistgov/DataModelDict">DataModelDict</a></li>
<li><a class="reference external" href="https://github.com/usnistgov/atomman">atomman</a></li>
<li><a class="reference external" href="https://github.com/usnistgov/iprPy">iprPy</a></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="c1"># http://www.numpy.org/</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># https://pandas.pydata.org/</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># https://github.com/usnistgov/DataModelDict</span>
<span class="kn">from</span> <span class="nn">DataModelDict</span> <span class="k">import</span> <span class="n">DataModelDict</span> <span class="k">as</span> <span class="n">DM</span>

<span class="c1"># https://github.com/usnistgov/atomman</span>
<span class="kn">import</span> <span class="nn">atomman</span> <span class="k">as</span> <span class="nn">am</span>
<span class="kn">import</span> <span class="nn">atomman.lammps</span> <span class="k">as</span> <span class="nn">lmp</span>
<span class="kn">import</span> <span class="nn">atomman.unitconvert</span> <span class="k">as</span> <span class="nn">uc</span>

<span class="c1"># https://github.com/usnistgov/iprPy</span>
<span class="kn">import</span> <span class="nn">iprPy</span>
</pre></div>
</div>
</div>
<p>Import plotting library for the Notebook</p>
<ul class="simple">
<li><a class="reference external" href="https://matplotlib.org/">matplotlib</a></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">cm</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="section" id="1.2.-Default-calculation-setup">
<h4>1.2. Default calculation setup<a class="headerlink" href="#1.2.-Default-calculation-setup" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Specify calculation style</span>
<span class="n">calc_style</span> <span class="o">=</span> <span class="s1">&#39;stacking_fault_map_2D&#39;</span>

<span class="c1"># If workingdir is already set, then do nothing (already in correct folder)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">workingdir</span> <span class="o">=</span> <span class="n">workingdir</span>

<span class="c1"># Change to workingdir if not already there</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">workingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;calculationfiles&#39;</span><span class="p">,</span> <span class="n">calc_style</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">workingdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">workingdir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">workingdir</span><span class="p">)</span>

<span class="c1"># Default iprPy library directory</span>
<span class="n">librarydir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iprPy</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;library&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-Assign-values-for-the-calculation's-run-parameters">
<h3>2. Assign values for the calculation’s run parameters<a class="headerlink" href="#2.-Assign-values-for-the-calculation's-run-parameters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="2.1-Specify-system-specific-paths">
<h4>2.1 Specify system-specific paths<a class="headerlink" href="#2.1-Specify-system-specific-paths" title="Permalink to this headline">¶</a></h4>
<p>Simple input parameters:</p>
<ul class="simple">
<li><strong>lammps_command</strong> is the LAMMPS command to use.</li>
<li><strong>mpi_command</strong> MPI command for running LAMMPS in parallel. A value
of None will run simulations serially.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;lmp_serial&#39;</span>
<span class="n">mpi_command</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.2.-Load-interatomic-potential">
<h4>2.2. Load interatomic potential<a class="headerlink" href="#2.2.-Load-interatomic-potential" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>potential_name</strong> gives the name of the potential_LAMMPS reference
record in the iprPy library to use for the calculation.</li>
<li><strong>potential_file</strong> gives the path to the potential_LAMMPS reference
record to use. Here, this parameter is automatically generated using
potential_name and librarydir.</li>
<li><strong>potential_dir</strong> gives the path for the folder containing the
artifacts associated with the potential (i.e. eam.alloy file). Here,
this parameter is automatically generated using potential_name and
librarydir.</li>
<li><strong>potential</strong> is an atomman.lammps.Potential object (required). Here,
this parameter is automatically generated from potential_file and
potential_dir.</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">potential_name</span> <span class="o">=</span> <span class="s1">&#39;1999--Mishin-Y--Ni--LAMMPS--ipr1&#39;</span>

<span class="c1"># Define potential_file and potential_dir using librarydir and potential_name</span>
<span class="n">potential_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">librarydir</span><span class="p">,</span> <span class="s1">&#39;potential_LAMMPS&#39;</span><span class="p">,</span> <span class="n">potential_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span>
<span class="n">potential_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">librarydir</span><span class="p">,</span> <span class="s1">&#39;potential_LAMMPS&#39;</span><span class="p">,</span> <span class="n">potential_name</span><span class="p">)</span>

<span class="c1"># Initialize Potential object using potential_file and potential_dir.</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="n">potential_file</span><span class="p">,</span> <span class="n">potential_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully loaded potential&#39;</span><span class="p">,</span> <span class="n">potential</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Successfully loaded potential 1999--Mishin-Y--Ni--LAMMPS--ipr1
</pre></div></div>
</div>
</div>
<div class="section" id="2.3.-Load-initial-unit-cell-system">
<h4>2.3. Load initial unit cell system<a class="headerlink" href="#2.3.-Load-initial-unit-cell-system" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>prototype_name</strong> gives the name of the crystal_prototype
reference record in the iprPy library to load.</li>
<li><strong>symbols</strong> is a list of the potential’s elemental model symbols to
associate with the unique atom types of the loaded system.</li>
<li><strong>box_parameters</strong> is a list of the a, b, c lattice constants to
assign to the loaded file.</li>
<li><strong>load_file</strong> gives the path to the atomic configuration file to
load for the ucell system. Here, this is generated automatically
using prototype_name and librarydir.</li>
<li><strong>load_style</strong> specifies the format of load_file. Here, this is
automatically set for crystal_prototype records.</li>
<li><strong>load_options</strong> specifies any other keyword options for properly
loading the load_file. Here, this is automatically set for
crystal_prototype records.</li>
<li><strong>ucell</strong> is an atomman.System representing a fundamental unit cell
of the system (required). Here, this is generated using the load_*
parameters and symbols.</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">prototype_name</span> <span class="o">=</span> <span class="s1">&#39;A1--Cu--fcc&#39;</span>
<span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ni&#39;</span><span class="p">]</span>
<span class="n">box_parameters</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">([</span><span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">],</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>

<span class="c1"># Define load_file using librarydir and prototype_name</span>
<span class="n">load_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">librarydir</span><span class="p">,</span> <span class="s1">&#39;crystal_prototype&#39;</span><span class="p">,</span> <span class="n">prototype_name</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>

<span class="c1"># Define load_style and load_options for crystal_prototype records</span>
<span class="n">load_style</span> <span class="o">=</span> <span class="s1">&#39;system_model&#39;</span>
<span class="n">load_options</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Create ucell by loading prototype record</span>
<span class="n">ucell</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_style</span><span class="p">,</span> <span class="n">load_file</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="o">**</span><span class="n">load_options</span><span class="p">)</span>

<span class="c1"># Rescale ucell using box_parameters</span>
<span class="n">ucell</span><span class="o">.</span><span class="n">box_set</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">box_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">box_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">box_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
avect =  [ 3.520,  0.000,  0.000]
bvect =  [ 0.000,  3.520,  0.000]
cvect =  [ 0.000,  0.000,  3.520]
origin = [ 0.000,  0.000,  0.000]
natoms = 4
natypes = 1
symbols = (&#39;Ni&#39;,)
pbc = [ True  True  True]
     id |   atype |  pos[0] |  pos[1] |  pos[2]
      0 |       1 |   0.000 |   0.000 |   0.000
      1 |       1 |   0.000 |   1.760 |   1.760
      2 |       1 |   1.760 |   0.000 |   1.760
      3 |       1 |   1.760 |   1.760 |   0.000
</pre></div></div>
</div>
</div>
<div class="section" id="2.4.-Specify-the-defect-parameters">
<h4>2.4. Specify the defect parameters<a class="headerlink" href="#2.4.-Specify-the-defect-parameters" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>stackingfault_name</strong> gives the name of the stacking_fault
reference record in the iprPy library to use.</li>
<li><strong>numshifts1</strong> is the number of shifts along shiftvector1 to
evaluate.</li>
<li><strong>numshifts2</strong> is the number of shifts along shiftvector2 to
evaluate.</li>
<li><strong>stackingfault_file</strong> gives the path to the stacking_fault
reference record to use. Here, this is built automatically using
stackingfault_name and librarydir.</li>
<li><strong>cutboxvector</strong> specifies which of the three box vectors (‘a’, ‘b’,
or ‘c’) is to be made non-periodic to create the free surface. Here,
this is extracted from the defect model.</li>
<li><strong>faultpos</strong> specifies the relative position within the rotated cell
before applying sizemults where the fault plane is placed. Here, this
is extracted from the defect model.</li>
<li><strong>shiftvector1, shiftvector2</strong> specify two non-parallel Miller
crystal vectors within the fault plane corresponding to full planar
shifts from one perfect crystal configuration to another. Here, these
are extracted from the defect model.</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">stackingfault_name</span> <span class="o">=</span> <span class="s1">&#39;A1--Cu--fcc--111sf&#39;</span>

<span class="n">numshifts1</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">numshifts2</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># Define surface_file using librarydir and surface_name</span>
<span class="n">stackingfault_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">librarydir</span><span class="p">,</span> <span class="s1">&#39;stacking_fault&#39;</span><span class="p">,</span> <span class="n">stackingfault_name</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>

<span class="c1"># Parse freesurface_file using iprPy.input.interpret()</span>
<span class="n">defectinputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stackingfault_file&#39;</span><span class="p">:</span><span class="n">stackingfault_file</span><span class="p">}</span>
<span class="n">iprPy</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="s1">&#39;stackingfaultpart1&#39;</span><span class="p">,</span> <span class="n">defectinputs</span><span class="p">)</span>

<span class="c1"># Extract parameters from defect model</span>
<span class="n">cutboxvector</span> <span class="o">=</span> <span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;stackingfault_cutboxvector&#39;</span><span class="p">]</span>
<span class="n">faultpos</span> <span class="o">=</span> <span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;stackingfault_faultpos&#39;</span><span class="p">]</span>
<span class="n">shiftvector1</span> <span class="o">=</span> <span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;stackingfault_shiftvector1&#39;</span><span class="p">]</span>
<span class="n">shiftvector2</span> <span class="o">=</span> <span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;stackingfault_shiftvector2&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutboxvector =&#39;</span><span class="p">,</span> <span class="n">cutboxvector</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;faultpos =&#39;</span><span class="p">,</span> <span class="n">faultpos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;shiftvector1 =&#39;</span><span class="p">,</span> <span class="n">shiftvector1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;shiftvector2 =&#39;</span><span class="p">,</span> <span class="n">shiftvector2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cutboxvector = c
faultpos = 0.5
shiftvector1 =  0.5 -0.5  0.0
shiftvector2 =  0.5  0.5 -1.0
</pre></div></div>
</div>
</div>
<div class="section" id="2.5.-Modify-system">
<h4>2.5. Modify system<a class="headerlink" href="#2.5.-Modify-system" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>a_uvw</strong> Miller crystal vector used to generate a rotated system
from ucell. The a box vector of the rotated system will correspond to
the crystal vector relative to ucell. Here, this is extracted from
the defect model.</li>
<li><strong>b_uvw</strong> Miller crystal vector used to generate a rotated system
from ucell. The a box vector of the rotated system will correspond to
the crystal vector relative to ucell. Here, this is extracted from
the defect model.</li>
<li><strong>c_uvw</strong> Miller crystal vector used to generate a rotated system
from ucell. The a box vector of the rotated system will correspond to
the crystal vector relative to ucell. Here, this is extracted from
the defect model.</li>
<li><strong>atomshift</strong> fractional rigid body shift to apply to the rotated
system. Here, this is extracted from the defect model.</li>
<li><strong>sizemults</strong> list of three integers specifying how many times the
ucell vectors of <span class="math">\(a\)</span>, <span class="math">\(b\)</span> and <span class="math">\(c\)</span> are replicated in
creating system.</li>
<li><strong>system</strong> is an atomman.System to use as the input system for the
calculation (required).</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">sizemults</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="c1"># Extract parameters from defect model</span>
<span class="n">a_uvw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;a_uvw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">b_uvw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;b_uvw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">c_uvw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;c_uvw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">atomshift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">defectinputs</span><span class="p">[</span><span class="s1">&#39;atomshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_uvw =&#39;</span><span class="p">,</span> <span class="n">a_uvw</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b_uvw =&#39;</span><span class="p">,</span> <span class="n">b_uvw</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c_uvw =&#39;</span><span class="p">,</span> <span class="n">c_uvw</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;atomshift =&#39;</span><span class="p">,</span> <span class="n">atomshift</span><span class="p">)</span>

<span class="c1"># Rotate to specified uvws</span>
<span class="n">system</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ucell</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_uvw</span><span class="p">,</span> <span class="n">b_uvw</span><span class="p">,</span> <span class="n">c_uvw</span><span class="p">]),</span> <span class="n">return_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Scale atomshift by rotated system&#39;s box vectors</span>
<span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">atomshift</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">avect</span> <span class="o">+</span>
         <span class="n">atomshift</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">bvect</span> <span class="o">+</span>
         <span class="n">atomshift</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">cvect</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">shift</span>

<span class="c1"># Generate system by supersizing ucell</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">supersize</span><span class="p">(</span><span class="o">*</span><span class="n">sizemults</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of atoms in system =&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">natoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
a_uvw = [ 1. -1.  0.]
b_uvw = [ 1.  1. -2.]
c_uvw = [ 1.  1.  1.]
atomshift = [ 0.01  0.01  0.01]
# of atoms in system = 6000
</pre></div></div>
</div>
</div>
<div class="section" id="2.6.-Modify-defect-parameters-based-on-modified-system-information">
<h4>2.6. Modify defect parameters based on modified system information<a class="headerlink" href="#2.6.-Modify-defect-parameters-based-on-modified-system-information" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>shiftvector1, shiftvector2</strong> are converted to Cartesian vectors and
transformed relative to the rotated system.</li>
<li><strong>faultpos</strong> is adjusted to be relative to the supercell system by
placing the cut inside a/the center cell replica.</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Convert shift vectors from crystallographic to Cartesian vectors</span>
<span class="n">shiftvector1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shiftvector1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">shiftvector2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shiftvector2</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">cartshiftvector1</span> <span class="o">=</span> <span class="n">ucell</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">shiftvector1</span><span class="p">)</span>
<span class="n">cartshiftvector2</span> <span class="o">=</span> <span class="n">ucell</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">vects</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">shiftvector2</span><span class="p">)</span>

<span class="c1"># Transform shift vectors</span>
<span class="n">cartshiftvector1</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cartshiftvector1</span><span class="p">)</span>
<span class="n">cartshiftvector1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cartshiftvector1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">cartshiftvector2</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cartshiftvector2</span><span class="p">)</span>
<span class="n">cartshiftvector2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cartshiftvector2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Identify number of size multiples, m, along cutboxvector</span>
<span class="k">if</span>   <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">sizemults</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># For odd m, initial position of 0.5 goes to 0.5</span>
<span class="k">if</span> <span class="n">m</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">faultpos</span> <span class="o">=</span> <span class="p">(</span><span class="n">faultpos</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span>
<span class="c1"># For even m, initial position of 0.0 goes to 0.5</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">faultpos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">faultpos</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;faultpos =&#39;</span><span class="p">,</span> <span class="n">faultpos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cartshiftvector1 =&#39;</span><span class="p">,</span> <span class="n">cartshiftvector1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cartshiftvector2 =&#39;</span><span class="p">,</span> <span class="n">cartshiftvector2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
faultpos = 0.55
cartshiftvector1 = [ 2.48901587  0.          0.        ]
cartshiftvector2 = [ 0.          4.31110195  0.        ]
</pre></div></div>
</div>
</div>
<div class="section" id="2.6.-Specify-calculation-specific-run-parameters">
<h4>2.6. Specify calculation-specific run parameters<a class="headerlink" href="#2.6.-Specify-calculation-specific-run-parameters" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>energytolerance</strong> is the energy tolerance to use during the
minimizations. This is unitless.</li>
<li><strong>forcetolerance</strong> is the force tolerance to use during the
minimizations. This is in energy/length units.</li>
<li><strong>maxiterations</strong> is the maximum number of minimization iterations to
use.</li>
<li><strong>maxevaluations</strong> is the maximum number of minimization evaluations
to use.</li>
<li><strong>maxatommotion</strong> is the largest distance that an atom is allowed to
move during a minimization iteration. This is in length units.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energytolerance</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="n">forcetolerance</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;eV/angstrom&#39;</span><span class="p">)</span>
<span class="n">maxiterations</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">maxevaluations</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">maxatommotion</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="3.-Define-calculation-function(s)-and-generate-template-LAMMPS-script(s)">
<h3>3. Define calculation function(s) and generate template LAMMPS script(s)<a class="headerlink" href="#3.-Define-calculation-function(s)-and-generate-template-LAMMPS-script(s)" title="Permalink to this headline">¶</a></h3>
<div class="section" id="3.1.-sfmin.template">
<h4>3.1. sfmin.template<a class="headerlink" href="#3.1.-sfmin.template" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sfmin.template&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;#LAMMPS input script that performs an energy minimization</span>
<span class="s2">#for a system with a stacking fault</span>

<span class="s2">&lt;atomman_system_info&gt;</span>

<span class="s2">&lt;atomman_pair_info&gt;</span>

<span class="s2">&lt;fix_cut_setforce&gt;</span>

<span class="s2">thermo_style custom step lx ly lz pxx pyy pzz pe</span>
<span class="s2">thermo_modify format float </span><span class="si">%.13e</span><span class="s2"></span>

<span class="s2">compute peatom all pe/atom</span>

<span class="s2">min_modify dmax &lt;dmax&gt;</span>

<span class="s2">dump dumpit all custom &lt;maxeval&gt; &lt;sim_directory&gt;*.dump id type x y z c_peatom</span>
<span class="s2">dump_modify dumpit format &lt;dump_modify_format&gt;</span>

<span class="s2">minimize &lt;etol&gt; &lt;ftol&gt; &lt;maxiter&gt; &lt;maxeval&gt;&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.2.-stackingfaultpoint()">
<h4>3.2. stackingfaultpoint()<a class="headerlink" href="#3.2.-stackingfaultpoint()" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">stackingfaultpoint</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                       <span class="n">mpi_command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sim_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">cutboxvector</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">faultpos</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">faultshift</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">etol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                       <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">maxeval</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                       <span class="n">dmax</span><span class="o">=</span><span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">),</span>
                       <span class="n">lammps_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a stacking fault relaxation simulation for a single faultshift.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lammps_command :str</span>
<span class="sd">        Command for running LAMMPS.</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to perform the calculation on.</span>
<span class="sd">    potential : atomman.lammps.Potential</span>
<span class="sd">        The LAMMPS implemented potential to use.</span>
<span class="sd">    mpi_command : str, optional</span>
<span class="sd">        The MPI command for running LAMMPS in parallel.  If not given, LAMMPS</span>
<span class="sd">        will run serially.</span>
<span class="sd">    sim_directory : str, optional</span>
<span class="sd">        The path to the directory to perform the simuation in.  If not</span>
<span class="sd">        given, will use the current working directory.</span>
<span class="sd">    etol : float, optional</span>
<span class="sd">        The energy tolerance for the structure minimization. This value is</span>
<span class="sd">        unitless. (Default is 0.0).</span>
<span class="sd">    ftol : float, optional</span>
<span class="sd">        The force tolerance for the structure minimization. This value is in</span>
<span class="sd">        units of force. (Default is 0.0).</span>
<span class="sd">    maxiter : int, optional</span>
<span class="sd">        The maximum number of minimization iterations to use (default is</span>
<span class="sd">        10000).</span>
<span class="sd">    maxeval : int, optional</span>
<span class="sd">        The maximum number of minimization evaluations to use (default is</span>
<span class="sd">        100000).</span>
<span class="sd">    dmax : float, optional</span>
<span class="sd">        The maximum distance in length units that any atom is allowed to relax</span>
<span class="sd">        in any direction during a single minimization iteration (default is</span>
<span class="sd">        0.01 Angstroms).</span>
<span class="sd">    cutboxvector : str, optional</span>
<span class="sd">        Indicates which of the three system box vectors, &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, to</span>
<span class="sd">        cut with a non-periodic boundary (default is &#39;c&#39;).</span>
<span class="sd">    faultpos : float, optional</span>
<span class="sd">        The fractional position along the cutboxvector where the stacking</span>
<span class="sd">        fault plane will be placed (default is 0.5).</span>
<span class="sd">    faultshift : list of float, optional</span>
<span class="sd">        The vector shift to apply to all atoms above the fault plane defined</span>
<span class="sd">        by faultpos (default is [0,0,0], i.e. no shift applied).</span>
<span class="sd">    lammps_date : datetime.date or None, optional</span>
<span class="sd">        The date version of the LAMMPS executable.  If None, will be identified from the lammps_command (default is None).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of results consisting of keys:</span>

<span class="sd">        - **&#39;logfile&#39;** (*str*) - The filename of the LAMMPS log file.</span>
<span class="sd">        - **&#39;dumpfile&#39;** (*str*) - The filename of the LAMMPS dump file</span>
<span class="sd">          of the relaxed system.</span>
<span class="sd">        - **&#39;system&#39;** (*atomman.System*) - The relaxed system.</span>
<span class="sd">        - **&#39;A_fault&#39;** (*float*) - The area of the fault surface.</span>
<span class="sd">        - **&#39;E_total&#39;** (*float*) - The total potential energy of the relaxed</span>
<span class="sd">          system.</span>
<span class="sd">        - **&#39;disp&#39;** (*float*) - The center of mass difference between atoms</span>
<span class="sd">          above and below the fault plane in the cutboxvector direction.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        For invalid cutboxvectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set options based on cutboxvector</span>
    <span class="k">if</span> <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
        <span class="c1"># Assert system is compatible with planeaxis value</span>
        <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xy</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xz</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;box tilts xy and xz must be 0 for cutboxvector=&#39;a&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Specify cutindex</span>
        <span class="n">cutindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Identify atoms above fault</span>
        <span class="n">faultpos</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">xlo</span> <span class="o">+</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lx</span> <span class="o">*</span> <span class="n">faultpos</span>
        <span class="n">abovefault</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">cutindex</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">faultpos</span><span class="p">)</span>

        <span class="c1"># Compute fault area</span>
        <span class="n">faultarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">bvect</span><span class="p">,</span>
                                            <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">cvect</span><span class="p">))</span>

        <span class="c1"># Give correct LAMMPS fix setforce command</span>
        <span class="n">fix_cut_setforce</span> <span class="o">=</span> <span class="s1">&#39;fix cut all setforce NULL 0 0&#39;</span>

    <span class="k">elif</span> <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="c1"># Assert system is compatible with planeaxis value</span>
        <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">yz</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;box tilt yz must be 0 for cutboxvector=&#39;b&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Specify cutindex</span>
        <span class="n">cutindex</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Identify atoms above fault</span>
        <span class="n">faultpos</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ylo</span> <span class="o">+</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">ly</span> <span class="o">*</span> <span class="n">faultpos</span>
        <span class="n">abovefault</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">cutindex</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">faultpos</span><span class="p">)</span>

        <span class="c1"># Compute fault area</span>
        <span class="n">faultarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">avect</span><span class="p">,</span>
                                            <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">cvect</span><span class="p">))</span>

        <span class="c1"># Give correct LAMMPS fix setforce command</span>
        <span class="n">fix_cut_setforce</span> <span class="o">=</span> <span class="s1">&#39;fix cut all setforce 0 NULL 0&#39;</span>

    <span class="k">elif</span> <span class="n">cutboxvector</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="c1"># Specify cutindex</span>
        <span class="n">cutindex</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># Identify atoms above fault</span>
        <span class="n">faultpos</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">zlo</span> <span class="o">+</span> <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lz</span> <span class="o">*</span> <span class="n">faultpos</span>
        <span class="n">abovefault</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">cutindex</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">faultpos</span><span class="p">)</span>

        <span class="c1"># Compute fault area</span>
        <span class="n">faultarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">avect</span><span class="p">,</span>
                                            <span class="n">system</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">bvect</span><span class="p">))</span>

        <span class="c1"># Give correct LAMMPS fix setforce command</span>
        <span class="n">fix_cut_setforce</span> <span class="o">=</span> <span class="s1">&#39;fix cut all setforce 0 0 NULL&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid cutboxvector&#39;</span><span class="p">)</span>

    <span class="c1"># Assert faultshift is in cut plane</span>
    <span class="k">if</span> <span class="n">faultshift</span><span class="p">[</span><span class="n">cutindex</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;faultshift must be in cut plane&#39;</span><span class="p">)</span>

    <span class="c1"># Generate stacking fault system by shifting atoms above the fault</span>
    <span class="n">sfsystem</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">sfsystem</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
    <span class="n">sfsystem</span><span class="o">.</span><span class="n">pbc</span><span class="p">[</span><span class="n">cutindex</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sfsystem</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">abovefault</span><span class="p">]</span> <span class="o">+=</span> <span class="n">faultshift</span>
    <span class="n">sfsystem</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">sim_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Create sim_directory if it doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">)</span>

        <span class="c1"># Add &#39;/&#39; to end of sim_directory string if needed</span>
        <span class="k">if</span> <span class="n">sim_directory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">sim_directory</span> <span class="o">=</span> <span class="n">sim_directory</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Set sim_directory if is None</span>
        <span class="n">sim_directory</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Get lammps units</span>
    <span class="n">lammps_units</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">unit</span><span class="p">(</span><span class="n">potential</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

    <span class="c1">#Get lammps version date</span>
    <span class="k">if</span> <span class="n">lammps_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lammps_date</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">checkversion</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>

    <span class="c1"># Define lammps variables</span>
    <span class="n">lammps_variables</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">system_info</span> <span class="o">=</span> <span class="n">sfsystem</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;atom_data&#39;</span><span class="p">,</span>
                                <span class="n">f</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">,</span> <span class="s1">&#39;system.dat&#39;</span><span class="p">),</span>
                                <span class="n">units</span><span class="o">=</span><span class="n">potential</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                <span class="n">atom_style</span><span class="o">=</span><span class="n">potential</span><span class="o">.</span><span class="n">atom_style</span><span class="p">)</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;atomman_system_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_info</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;atomman_pair_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential</span><span class="o">.</span><span class="n">pair_info</span><span class="p">(</span><span class="n">sfsystem</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;fix_cut_setforce&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fix_cut_setforce</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;sim_directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_directory</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;etol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">etol</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;ftol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">ftol</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxiter</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;maxeval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxeval</span>
    <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">dmax</span><span class="p">,</span> <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span>

    <span class="c1"># Set dump_modify format based on dump_modify_version</span>
    <span class="k">if</span> <span class="n">lammps_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_modify_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%.13e</span><span class="s1"> </span><span class="si">%.13e</span><span class="s1"> </span><span class="si">%.13e</span><span class="s1"> </span><span class="si">%.13e</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lammps_variables</span><span class="p">[</span><span class="s1">&#39;dump_modify_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;float </span><span class="si">%.13e</span><span class="s1">&#39;</span>

    <span class="c1"># Write lammps input script</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="s1">&#39;sfmin.template&#39;</span>
    <span class="n">lammps_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">,</span> <span class="s1">&#39;sfmin.in&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">iprPy</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">filltemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">lammps_variables</span><span class="p">,</span>
                                         <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">))</span>

    <span class="c1"># Run LAMMPS</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">lammps_script</span><span class="p">,</span> <span class="n">mpi_command</span><span class="p">,</span>
                     <span class="n">return_style</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
                     <span class="n">logfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">,</span> <span class="s1">&#39;log.lammps&#39;</span><span class="p">))</span>

    <span class="c1"># Extract output values</span>
    <span class="n">thermo</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">simulations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;thermo&#39;</span><span class="p">]</span>
    <span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">,</span> <span class="s1">&#39;log.lammps&#39;</span><span class="p">)</span>
    <span class="n">dumpfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_directory</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">.dump&#39;</span> <span class="o">%</span> <span class="n">thermo</span><span class="o">.</span><span class="n">Step</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">E_total</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="n">thermo</span><span class="o">.</span><span class="n">PotEng</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">lammps_units</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>

    <span class="c1">#Load relaxed system</span>
    <span class="n">sfsystem</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;atom_dump&#39;</span><span class="p">,</span> <span class="n">dumpfile</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">sfsystem</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>

    <span class="c1"># Find center of mass difference in top/bottom planes</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="p">(</span><span class="n">sfsystem</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">abovefault</span><span class="p">,</span> <span class="n">cutindex</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="o">-</span> <span class="n">sfsystem</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">~</span><span class="n">abovefault</span><span class="p">,</span> <span class="n">cutindex</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># Return results</span>
    <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logfile</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;dumpfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dumpfile</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sfsystem</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;A_fault&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faultarea</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_total</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp</span>

    <span class="k">return</span> <span class="n">results_dict</span>


</pre></div>
</div>
</div>
</div>
<div class="section" id="3.3.-stackingfaultworker()">
<h4>3.3. stackingfaultworker()<a class="headerlink" href="#3.3.-stackingfaultworker()" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">stackingfaultworker</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                        <span class="n">shiftvector1</span><span class="p">,</span> <span class="n">shiftvector2</span><span class="p">,</span> <span class="n">shiftfraction1</span><span class="p">,</span>
                        <span class="n">shiftfraction2</span><span class="p">,</span> <span class="n">mpi_command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutboxvector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">faultpos</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">etol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                        <span class="n">maxeval</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                        <span class="n">dmax</span><span class="o">=</span><span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">),</span>
                        <span class="n">lammps_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper function around stackingfaultpoint. Converts</span>
<span class="sd">    shiftfractions and shiftvectors to a faultshift, runs stackingfaultpoint,</span>
<span class="sd">    and adds keys &#39;shift1&#39; and &#39;shift2&#39; to the returned dictionary</span>
<span class="sd">    corresponding to the shiftfractions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute the faultshift</span>
    <span class="n">faultshift</span> <span class="o">=</span> <span class="n">shiftfraction1</span> <span class="o">*</span> <span class="n">shiftvector1</span> <span class="o">+</span> <span class="n">shiftfraction2</span> <span class="o">*</span> <span class="n">shiftvector2</span>

    <span class="c1"># Name the simulation directory based on shiftfractions</span>
    <span class="n">sim_directory</span> <span class="o">=</span> <span class="s1">&#39;a</span><span class="si">%.10f</span><span class="s1">-b</span><span class="si">%.10f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">shiftfraction1</span><span class="p">,</span> <span class="n">shiftfraction2</span><span class="p">)</span>

    <span class="c1"># Evaluate the system at the shift</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">stackingfaultpoint</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                            <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span>
                            <span class="n">cutboxvector</span><span class="o">=</span><span class="n">cutboxvector</span><span class="p">,</span>
                            <span class="n">faultpos</span><span class="o">=</span><span class="n">faultpos</span><span class="p">,</span>
                            <span class="n">etol</span><span class="o">=</span><span class="n">etol</span><span class="p">,</span>
                            <span class="n">ftol</span><span class="o">=</span><span class="n">ftol</span><span class="p">,</span>
                            <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                            <span class="n">maxeval</span><span class="o">=</span><span class="n">maxeval</span><span class="p">,</span>
                            <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">,</span>
                            <span class="n">faultshift</span><span class="o">=</span><span class="n">faultshift</span><span class="p">,</span>
                            <span class="n">sim_directory</span><span class="o">=</span><span class="n">sim_directory</span><span class="p">,</span>
                            <span class="n">lammps_date</span><span class="o">=</span><span class="n">lammps_date</span><span class="p">)</span>

    <span class="c1"># Add shiftfractions to sf results</span>
    <span class="n">sf</span><span class="p">[</span><span class="s1">&#39;shift1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shiftfraction1</span>
    <span class="n">sf</span><span class="p">[</span><span class="s1">&#39;shift2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shiftfraction2</span>

    <span class="k">return</span> <span class="n">sf</span>


</pre></div>
</div>
</div>
</div>
<div class="section" id="3.4.-stackingfaultmap()">
<h4>3.4. stackingfaultmap()<a class="headerlink" href="#3.4.-stackingfaultmap()" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">stackingfaultmap</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                     <span class="n">shiftvector1</span><span class="p">,</span> <span class="n">shiftvector2</span><span class="p">,</span> <span class="n">mpi_command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">numshifts1</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">numshifts2</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                     <span class="n">cutboxvector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faultpos</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">etol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">maxeval</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                     <span class="n">dmax</span><span class="o">=</span><span class="n">uc</span><span class="o">.</span><span class="n">set_in_units</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes a generalized stacking fault map for shifts along a regular 2D</span>
<span class="sd">    grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lammps_command :str</span>
<span class="sd">        Command for running LAMMPS.</span>
<span class="sd">    system : atomman.System</span>
<span class="sd">        The system to perform the calculation on.</span>
<span class="sd">    potential : atomman.lammps.Potential</span>
<span class="sd">        The LAMMPS implemented potential to use.</span>
<span class="sd">    shiftvector1 : list of floats or numpy.array</span>
<span class="sd">        One of the generalized stacking fault shifting vectors.</span>
<span class="sd">    shiftvector2 : list of floats or numpy.array</span>
<span class="sd">        One of the generalized stacking fault shifting vectors.</span>
<span class="sd">    mpi_command : str, optional</span>
<span class="sd">        The MPI command for running LAMMPS in parallel.  If not given, LAMMPS</span>
<span class="sd">        will run serially.</span>
<span class="sd">    etol : float, optional</span>
<span class="sd">        The energy tolerance for the structure minimization. This value is</span>
<span class="sd">        unitless. (Default is 0.0).</span>
<span class="sd">    ftol : float, optional</span>
<span class="sd">        The force tolerance for the structure minimization. This value is in</span>
<span class="sd">        units of force. (Default is 0.0).</span>
<span class="sd">    maxiter : int, optional</span>
<span class="sd">        The maximum number of minimization iterations to use (default is</span>
<span class="sd">        10000).</span>
<span class="sd">    maxeval : int, optional</span>
<span class="sd">        The maximum number of minimization evaluations to use (default is</span>
<span class="sd">        100000).</span>
<span class="sd">    dmax : float, optional</span>
<span class="sd">        The maximum distance in length units that any atom is allowed to relax</span>
<span class="sd">        in any direction during a single minimization iteration (default is</span>
<span class="sd">        0.01 Angstroms).</span>
<span class="sd">    cutboxvector : str, optional</span>
<span class="sd">        Indicates which of the three system box vectors, &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;, to</span>
<span class="sd">        cut with a non-periodic boundary (default is &#39;c&#39;).</span>
<span class="sd">    numshifts1 : int, optional</span>
<span class="sd">        The number of equally spaced shiftfractions to evaluate along</span>
<span class="sd">        shiftvector1.</span>
<span class="sd">    numshifts2 : int, optional</span>
<span class="sd">        The number of equally spaced shiftfractions to evaluate along</span>
<span class="sd">        shiftvector2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary of results consisting of keys:</span>

<span class="sd">        - **&#39;shift1&#39;** (*numpy.array of float*) - The fractional shifts along</span>
<span class="sd">          shiftvector1 where the stacking fault was evaluated.</span>
<span class="sd">        - **&#39;shift2&#39;** (*numpy.array of float*) - The fractional shifts along</span>
<span class="sd">          shiftvector2 where the stacking fault was evaluated.</span>
<span class="sd">        - **&#39;E_gsf&#39;** (*numpy.array of float*) - The stacking fault formation</span>
<span class="sd">          energies measured for all the (shift1, shift2) coordinates.</span>
<span class="sd">        - **&#39;delta_disp&#39;** (*numpy.array of float*) - The change in the center</span>
<span class="sd">          of mass difference between before and after applying the faultshift</span>
<span class="sd">          for all the (shift1, shift2) coordinates.</span>
<span class="sd">        - **&#39;A_fault&#39;** (*float*) - The area of the fault surface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Start sf_df as empty list</span>
    <span class="n">sf_df</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Construct mesh of regular points</span>
    <span class="n">shifts1</span><span class="p">,</span> <span class="n">shifts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">numshifts1</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">numshifts2</span><span class="p">))</span>

    <span class="c1"># Identify lammps_date version</span>
    <span class="n">lammps_date</span> <span class="o">=</span> <span class="n">lmp</span><span class="o">.</span><span class="n">checkversion</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>

    <span class="c1"># Loop over all shift combinations</span>
    <span class="k">for</span> <span class="n">shiftfraction1</span><span class="p">,</span> <span class="n">shiftfraction2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shifts1</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">shifts2</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="c1"># Evaluate the system at the shift</span>
        <span class="n">sf_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stackingfaultworker</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                                         <span class="n">shiftvector1</span><span class="p">,</span> <span class="n">shiftvector2</span><span class="p">,</span>
                                         <span class="n">shiftfraction1</span><span class="p">,</span> <span class="n">shiftfraction2</span><span class="p">,</span>
                                         <span class="n">mpi_command</span><span class="o">=</span><span class="n">mpi_command</span><span class="p">,</span>
                                         <span class="n">cutboxvector</span><span class="o">=</span><span class="n">cutboxvector</span><span class="p">,</span>
                                         <span class="n">faultpos</span><span class="o">=</span><span class="n">faultpos</span><span class="p">,</span>
                                         <span class="n">etol</span><span class="o">=</span><span class="n">etol</span><span class="p">,</span>
                                         <span class="n">ftol</span><span class="o">=</span><span class="n">ftol</span><span class="p">,</span>
                                         <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                         <span class="n">maxeval</span><span class="o">=</span><span class="n">maxeval</span><span class="p">,</span>
                                         <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">,</span>
                                         <span class="n">lammps_date</span><span class="o">=</span><span class="n">lammps_date</span><span class="p">))</span>

    <span class="c1"># Convert sf_df to pandas DataFrame</span>
    <span class="n">sf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sf_df</span><span class="p">)</span>

    <span class="c1"># Identify the zeroshift column</span>
    <span class="n">zeroshift</span> <span class="o">=</span> <span class="n">sf_df</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">sf_df</span><span class="o">.</span><span class="n">shift1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                     <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">sf_df</span><span class="o">.</span><span class="n">shift2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeroshift</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zeroshift simulation not uniquely identified&#39;</span>

    <span class="c1"># Get zeroshift values</span>
    <span class="n">E_total_0</span> <span class="o">=</span> <span class="n">zeroshift</span><span class="o">.</span><span class="n">E_total</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A_fault</span> <span class="o">=</span> <span class="n">zeroshift</span><span class="o">.</span><span class="n">A_fault</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">disp_0</span> <span class="o">=</span> <span class="n">zeroshift</span><span class="o">.</span><span class="n">disp</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Compute the stacking fault energy</span>
    <span class="n">E_gsf</span> <span class="o">=</span> <span class="p">(</span><span class="n">sf_df</span><span class="o">.</span><span class="n">E_total</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">E_total_0</span><span class="p">)</span> <span class="o">/</span> <span class="n">A_fault</span>

    <span class="c1"># Compute the change in displacement normal to fault plane</span>
    <span class="n">delta_disp</span> <span class="o">=</span> <span class="n">sf_df</span><span class="o">.</span><span class="n">disp</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">disp_0</span>

    <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;shift1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf_df</span><span class="o">.</span><span class="n">shift1</span><span class="o">.</span><span class="n">values</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;shift2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf_df</span><span class="o">.</span><span class="n">shift2</span><span class="o">.</span><span class="n">values</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_gsf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_gsf</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;delta_disp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_disp</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;A_fault&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_fault</span>

    <span class="k">return</span> <span class="n">results_dict</span>


</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="4.-Run-calculation-function(s)">
<h3>4. Run calculation function(s)<a class="headerlink" href="#4.-Run-calculation-function(s)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="n">stackingfaultmap</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span>
                                <span class="n">cartshiftvector1</span><span class="p">,</span> <span class="n">cartshiftvector2</span><span class="p">,</span>
                                <span class="n">mpi_command</span> <span class="o">=</span> <span class="n">mpi_command</span><span class="p">,</span>
                                <span class="n">numshifts1</span> <span class="o">=</span> <span class="n">numshifts1</span><span class="p">,</span>
                                <span class="n">numshifts2</span> <span class="o">=</span> <span class="n">numshifts2</span><span class="p">,</span>
                                <span class="n">cutboxvector</span> <span class="o">=</span> <span class="n">cutboxvector</span><span class="p">,</span>
                                <span class="n">faultpos</span> <span class="o">=</span> <span class="n">faultpos</span><span class="p">,</span>
                                <span class="n">etol</span> <span class="o">=</span> <span class="n">energytolerance</span><span class="p">,</span>
                                <span class="n">ftol</span> <span class="o">=</span> <span class="n">forcetolerance</span><span class="p">,</span>
                                <span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiterations</span><span class="p">,</span>
                                <span class="n">maxeval</span> <span class="o">=</span> <span class="n">maxevaluations</span><span class="p">,</span>
                                <span class="n">dmax</span> <span class="o">=</span> <span class="n">maxatommotion</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[16]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>dict_keys([&#39;shift1&#39;, &#39;shift2&#39;, &#39;E_gsf&#39;, &#39;delta_disp&#39;, &#39;A_fault&#39;])
</pre></div>
</div>
</div>
</div>
<div class="section" id="5.-Report-results">
<h3>5. Report results<a class="headerlink" href="#5.-Report-results" title="Permalink to this headline">¶</a></h3>
<div class="section" id="5.1.-Define-units-for-outputting-values">
<h4>5.1. Define units for outputting values<a class="headerlink" href="#5.1.-Define-units-for-outputting-values" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>length_unit</strong> is the unit of area to display delta displacemets
in.</li>
<li><strong>area_unit</strong> is the unit of area to display fault area in.</li>
<li><strong>energy_unit</strong> is the unit of energy to display cohesive energies
in.</li>
<li><strong>energyperarea_unit</strong> is the energy per area to report the surface
energy in.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">length_unit</span> <span class="o">=</span> <span class="s1">&#39;nm&#39;</span>
<span class="n">area_unit</span> <span class="o">=</span> <span class="s1">&#39;nm^2&#39;</span>
<span class="n">energy_unit</span> <span class="o">=</span> <span class="s1">&#39;eV&#39;</span>
<span class="n">energyperarea_unit</span> <span class="o">=</span> <span class="s1">&#39;mJ/m^2&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="5.2.-Print-">
<h4>5.2. Print <span class="math">\(A_{fault}\)</span><a class="headerlink" href="#5.2.-Print-" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A_fault =&#39;</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_in_units</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;A_fault&#39;</span><span class="p">],</span> <span class="n">area_unit</span><span class="p">),</span> <span class="n">area_unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
A_fault = 10.7304011631 nm^2
</pre></div></div>
</div>
</div>
<div class="section" id="5.3.-Load-results-as-an-atomman.defect.GammaSurface-object-and-plot-data">
<h4>5.3. Load results as an atomman.defect.GammaSurface object and plot data<a class="headerlink" href="#5.3.-Load-results-as-an-atomman.defect.GammaSurface-object-and-plot-data" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">gamma</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">defect</span><span class="o">.</span><span class="n">GammaSurface</span><span class="p">(</span><span class="n">a1vect</span><span class="o">=</span><span class="n">shiftvector1</span><span class="p">,</span>
                               <span class="n">a2vect</span><span class="o">=</span><span class="n">shiftvector2</span><span class="p">,</span>
                               <span class="n">box</span><span class="o">=</span><span class="n">ucell</span><span class="o">.</span><span class="n">box</span><span class="p">,</span>
                               <span class="n">a1</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;shift1&#39;</span><span class="p">],</span>
                               <span class="n">a2</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;shift2&#39;</span><span class="p">],</span>
                               <span class="n">E_gsf</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;E_gsf&#39;</span><span class="p">],</span>
                               <span class="n">delta</span><span class="o">=</span><span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;delta_disp&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">gamma</span><span class="o">.</span><span class="n">E_gsf_surface_plot</span><span class="p">(</span><span class="n">length_unit</span><span class="o">=</span><span class="n">length_unit</span><span class="p">,</span> <span class="n">energyperarea_unit</span><span class="o">=</span><span class="n">energyperarea_unit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_stacking_fault_map_2D_44_0.png" src="../_images/notebook_stacking_fault_map_2D_44_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">gamma</span><span class="o">.</span><span class="n">E_gsf_line_plot</span><span class="p">(</span><span class="n">vect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">length_unit</span><span class="o">=</span><span class="n">length_unit</span><span class="p">,</span>
                      <span class="n">energyperarea_unit</span><span class="o">=</span><span class="n">energyperarea_unit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_stacking_fault_map_2D_45_0.png" src="../_images/notebook_stacking_fault_map_2D_45_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">gamma</span><span class="o">.</span><span class="n">delta_line_plot</span><span class="p">(</span><span class="n">vect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">length_unit</span><span class="o">=</span><span class="n">length_unit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebook_stacking_fault_map_2D_46_0.png" src="../_images/notebook_stacking_fault_map_2D_46_0.png" />
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">stacking_fault_map_2D Calculation</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Method-and-Theory">Method and Theory</a></li>
<li><a class="reference internal" href="#Demonstration">Demonstration</a><ul>
<li><a class="reference internal" href="#1.-Library-imports">1. Library imports</a><ul>
<li><a class="reference internal" href="#1.2.-Default-calculation-setup">1.2. Default calculation setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Assign-values-for-the-calculation's-run-parameters">2. Assign values for the calculation’s run parameters</a><ul>
<li><a class="reference internal" href="#2.1-Specify-system-specific-paths">2.1 Specify system-specific paths</a></li>
<li><a class="reference internal" href="#2.2.-Load-interatomic-potential">2.2. Load interatomic potential</a></li>
<li><a class="reference internal" href="#2.3.-Load-initial-unit-cell-system">2.3. Load initial unit cell system</a></li>
<li><a class="reference internal" href="#2.4.-Specify-the-defect-parameters">2.4. Specify the defect parameters</a></li>
<li><a class="reference internal" href="#2.5.-Modify-system">2.5. Modify system</a></li>
<li><a class="reference internal" href="#2.6.-Modify-defect-parameters-based-on-modified-system-information">2.6. Modify defect parameters based on modified system information</a></li>
<li><a class="reference internal" href="#2.6.-Specify-calculation-specific-run-parameters">2.6. Specify calculation-specific run parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Define-calculation-function(s)-and-generate-template-LAMMPS-script(s)">3. Define calculation function(s) and generate template LAMMPS script(s)</a><ul>
<li><a class="reference internal" href="#3.1.-sfmin.template">3.1. sfmin.template</a></li>
<li><a class="reference internal" href="#3.2.-stackingfaultpoint()">3.2. stackingfaultpoint()</a></li>
<li><a class="reference internal" href="#3.3.-stackingfaultworker()">3.3. stackingfaultworker()</a></li>
<li><a class="reference internal" href="#3.4.-stackingfaultmap()">3.4. stackingfaultmap()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4.-Run-calculation-function(s)">4. Run calculation function(s)</a></li>
<li><a class="reference internal" href="#5.-Report-results">5. Report results</a><ul>
<li><a class="reference internal" href="#5.1.-Define-units-for-outputting-values">5.1. Define units for outputting values</a></li>
<li><a class="reference internal" href="#5.2.-Print-">5.2. Print <span class="math">\(A_{fault}\)</span></a></li>
<li><a class="reference internal" href="#5.3.-Load-results-as-an-atomman.defect.GammaSurface-object-and-plot-data">5.3. Load results as an atomman.defect.GammaSurface object and plot data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="relax_static.html"
                        title="previous chapter">relax_static Calculation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="surface_energy_static.html"
                        title="next chapter">surface_energy Calculation</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="surface_energy_static.html" title="surface_energy Calculation"
             >next</a> |</li>
        <li class="right" >
          <a href="relax_static.html" title="relax_static Calculation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">iprPy 0.8.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../notebook_styles.html" >Jupyter Demonstration Notebooks</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>