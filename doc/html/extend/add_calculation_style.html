<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating Calculation Styles &#8212; iprPy 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LAMMPS Calculations Using atomman" href="calc_atomman.html" />
    <link rel="prev" title="Adding new library parameter records" href="add_parameter_record.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">iprPy 0.7.2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="add_parameter_record.html" title="Adding new library parameter records"
             accesskey="P">previous</a> |
          <a href="calc_atomman.html" title="LAMMPS Calculations Using atomman"
             accesskey="N">next</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-calculation-styles">
<h1>Creating Calculation Styles<a class="headerlink" href="#creating-calculation-styles" title="Permalink to this headline">¶</a></h1>
<p><strong>Note</strong>:  The easiest way to start creating a new calculation is to copy an
existing one and then modify its contents. Then, this documentation can serve
as a guide for describing the various components.</p>
<div class="section" id="calculation-scripts">
<h2>Calculation scripts<a class="headerlink" href="#calculation-scripts" title="Permalink to this headline">¶</a></h2>
<p>Each calculation style is centered around the corresponding calculation
script.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>There are only a few basic requirements for the calculation scripts.</p>
<ul class="simple">
<li>The script’s file name is ‘calc_&lt;calc_name&gt;.py’, where &lt;calc_name&gt; is the
name of the calculation style.</li>
<li>The script is directly executable and reads in all variable inputs from an
input file given as a command line argument.</li>
<li>Upon successful completion, it generates a ‘results.json’ file consistent
with a Record style.</li>
</ul>
</div>
<div class="section" id="design-guidelines">
<h3>Design guidelines<a class="headerlink" href="#design-guidelines" title="Permalink to this headline">¶</a></h3>
<p>While nothing else is required, there are a few additional guidelines towards
the design of the calculation scripts. These guidelines help make the contents
of the calculation scripts clear, and their behaviors consistent with the
other calculations.  Additionally, it allows for new scripts to take advantage
of some of the pre-existing tools.</p>
<div class="section" id="style-definitions">
<h4>Style definitions<a class="headerlink" href="#style-definitions" title="Permalink to this headline">¶</a></h4>
<p>Variables <em>calc_style</em> and <em>record_style</em> define the Calculation style and
Record style associated with the calculation script.   These definitions
should be placed after the imports but before any defined functions.</p>
</div>
<div class="section" id="main-function">
<h4><em>main()</em> function<a class="headerlink" href="#main-function" title="Permalink to this headline">¶</a></h4>
<p>The first defined function is <em>main(*args)</em>.  This is the primary function
for the calculation.  It should be called when the script is executed by
placing at the very bottom of the script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
<p>The <em>main()</em> function should</p>
<ul>
<li><p class="first">Read the input file and convert to a dictionary with parseinput:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">input_dict</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">parseinput</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">allsingular</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Interpret and process input parameters with the <em>process_input()</em> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">process_input</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</li>
<li><p class="first">Call any calculation functions using the processed input parameters.</p>
</li>
<li><p class="first">Generate the “results.json” file with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">buildmodel</span><span class="p">(</span><span class="n">record_style</span><span class="p">,</span> <span class="s1">&#39;calc_&#39;</span> <span class="o">+</span> <span class="n">calc_style</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">,</span>
                           <span class="n">results_dict</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>This design allows for the separation of the input-output control from the
code that does the actual calculation work.</p>
</div>
<div class="section" id="calculation-functions">
<h4>Calculation functions<a class="headerlink" href="#calculation-functions" title="Permalink to this headline">¶</a></h4>
<p>The calculation functions are where the calculation is performed.  These are
separated from the <em>main()</em> function so that they can also be used without
modification outside of the calculation scripts.  To achieve this</p>
<ul class="simple">
<li>The calculation functions’ arguments should explicitly list parameters, i.e.
take specific terms from the generated input_dict rather than the input_dict
itself.</li>
<li>If a calculation function returns multiple terms to the <em>main()</em> function,
they should be returned within a dictionary as opposed to within a list/tuple
so that the terms can be properly named.</li>
<li>The actions of a calculation function, all input parameters and returned
terms should be documented and described in the function’s docstring.  The
currently implemented calculation’s use numpy’s docstring format.</li>
</ul>
</div>
<div class="section" id="process-input-function">
<h4><em>process_input()</em> function<a class="headerlink" href="#process-input-function" title="Permalink to this headline">¶</a></h4>
<p>The handling of the input parameter files is a two-step process</p>
<ul class="simple">
<li>*iprPy.tools.parseinput()* parses the input file converting it into a
dictionary with string values</li>
<li>The calculation’s <em>process_input()</em> function interprets input_dict’s terms
into meaningful arguments for the calculation function.</li>
</ul>
<p>The <em>process_input()</em> function modifies the <em>input_dict</em> generated from
<em>iprPy.tools.parseinput()</em> by converting the string values to other data
types, assigning default values to any missing terms, and adding new terms
with complex values.  For simple terms, this can easily be handled with the
dict.get() method, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">input_dict</span><span class="p">[</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">default</span><span class="o">&gt;</span><span class="p">))</span>
</pre></div>
</div>
<p>The iprPy.input submodule contains functions for more complex and challenging
conversions.  Two of the basic functions of this module are</p>
<ul class="simple">
<li>iprPy.input.boolean(value) which converts a str value of ‘t’, ‘true’, ‘f’,
or ‘false’ to the corresponding bool.</li>
<li>iprPy.input.value(input_dict, key, default_unit=None, default_term=None)
which allows for the handling of input parameters for floats that may have
specific units specified.</li>
</ul>
<p>Additional functions in the iprPy.input module are focused around common
handling of atomistic inputs for LAMMPS simulations using the atomman package.
More information can be found on the <a class="reference internal" href="calc_atomman.html"><span class="doc">LAMMPS Calculations Using atomman</span></a> page.</p>
</div>
<div class="section" id="results-generation">
<h4>Results generation<a class="headerlink" href="#results-generation" title="Permalink to this headline">¶</a></h4>
<p>When first creating a calculation, it is probably helpful to print the
generated calculation results in a simple format for testing and verification
of the methodology.  Once the calculation method is stable and the result
terms produced by the calculation functions are defined, then check out the
<a class="reference internal" href="../modules/iprPy.html#iprPy.Database.add_record" title="iprPy.Database.add_record"><code class="xref any py py-meth docutils literal"><span class="pre">add_record</span></code></a> page for how to create a Record style for the calculation.
The generation of the “results.json” file is handled by the Record style
rather than the Calculation style as the results file is a complete record.</p>
</div>
</div>
</div>
<div class="section" id="implementing-a-calculation-style-into-iprpy">
<h2>Implementing a Calculation Style into iprPy<a class="headerlink" href="#implementing-a-calculation-style-into-iprpy" title="Permalink to this headline">¶</a></h2>
<p>A working calculation script can be implemented into the framework as a
calculation style by</p>
<ul class="simple">
<li>Creating a folder in the iprPy/calculation directory named for the
calculation style.</li>
<li>Placing the calculation script inside the calculation folder as well as any
other files that the calculation script needs to run (excluding inputs).</li>
<li>Creating a __init__.py file in the calculation folder that defines the
various functions and values that are to be accessed as methods and
attributes of the Calculation class.</li>
</ul>
<p>Simply creating a calculation folder and an __init__.py file with valid Python
code is enough for iprPy to recognize and load it as a Calculation style.
Interactivity through the Calculation class then comes from defining the
components of the class in the __init__.py file.  The components recognized by
the Calculation class are</p>
<ul class="simple">
<li>process_input() : The process_input function used to process the calculation
script’s input parameters.</li>
<li>files() : A function that yields the absolute path to all non-variable files
required by the calculation.  This includes the calculation script and any
data files accessed by the calculation script regardless of the input
parameters.</li>
<li>template() : A function that returns a template version of the calculation’s
input parameter file as a str.</li>
<li>prepare_keys : A dictionary listing all single- and multi-valued input keys
recognized by the calculation’s prepare function.</li>
<li>prepare() : The calculation’s prepare function.</li>
</ul>
<p>More information on template, prepare_keys and prepare is given in the
:<cite>any:calc_prepare</cite> documentation.</p>
<p>A working __init__.py file for the calculation is easiest to create by copying
one from an already implemented calculation. By default, it will expect</p>
<ul class="simple">
<li>The calculation script’s name to be “calc_&lt;calc_style&gt;.py”.</li>
<li>The calculation script to contain the <em>process_input()</em> function.</li>
<li>The template input file to be saved as “calc_&lt;calc_style&gt;.tempate” in the
calculation folder.</li>
<li>The calculation’s prepare script to be in the calculation folder and named
“prepare_&lt;calc_style&gt;.py”.</li>
<li>The prepare script to contain functions <em>prepare()</em>, <em>singularkeys()</em>, and
<em>multikeys()</em>.</li>
</ul>
<p>If these are all true, then the only change that needs to be made to the
__init__.py file is the list of file names yielded by the <em>files()</em> function.
If you want to test calling parts with the Calculation class before
implementing all the parts, you can comment out the calls to the pieces that
don’t exist yet.</p>
<div class="section" id="calculation-documentation">
<h3>Calculation Documentation<a class="headerlink" href="#calculation-documentation" title="Permalink to this headline">¶</a></h3>
<p>Finally, documentation for the calculation should be included in the
calculation folder.  The basic documentation consists of Markdown formatted
text files</p>
<ul class="simple">
<li>README.md : Provides author information for the calculation and a short
Introduction describing the calculation and providing any disclaimers for
when issues may arise due to the method or parameter choice.</li>
<li>theory.md : Provides a detailed description of how the calculation Method
is implemented and any underlying Theory behind the method.</li>
<li><em>More to come...</em></li>
</ul>
<p>The use of these pre-defined Markdown documentation files is advantageous as
they can be identified by automated scripts for inclusion in the online
documentation and directly copied into demonstration Jupyter Notebooks.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction to iprPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">iprPy Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../highthroughput/index.html">High-Throughput Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Adding Content to iprPy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="add_potential.html">Adding new potentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_parameter_record.html">Adding new library parameter records</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating Calculation Styles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calculation-scripts">Calculation scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#design-guidelines">Design guidelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#implementing-a-calculation-style-into-iprpy">Implementing a Calculation Style into iprPy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#calculation-documentation">Calculation Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="calc_atomman.html">LAMMPS Calculations Using atomman</a></li>
<li class="toctree-l2"><a class="reference internal" href="calc_prepare.html">Generating a Prepare Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_record_style.html">Constructing Record Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_database_style.html">Constructing Database Styles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calculation_styles.html">Calculation Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../record_styles.html">Record Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database_styles.html">Database Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">iprPy</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="add_parameter_record.html" title="Adding new library parameter records"
              >previous</a> |
            <a href="calc_atomman.html" title="LAMMPS Calculations Using atomman"
              >next</a> |
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/extend/add_calculation_style.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Lucas Hale.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>