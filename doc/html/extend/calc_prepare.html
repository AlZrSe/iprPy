<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generating a Prepare Script &#8212; iprPy 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Constructing Record Styles" href="add_record_style.html" />
    <link rel="prev" title="LAMMPS Calculations Using atomman" href="calc_atomman.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">iprPy 0.7.2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="calc_atomman.html" title="LAMMPS Calculations Using atomman"
             accesskey="P">previous</a> |
          <a href="add_record_style.html" title="Constructing Record Styles"
             accesskey="N">next</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generating-a-prepare-script">
<h1>Generating a Prepare Script<a class="headerlink" href="#generating-a-prepare-script" title="Permalink to this headline">¶</a></h1>
<p>The final component in developing a calculation to run in high-throughput with
iprPy is to create a prepare script.  The basic outline for a calculation&#8217;s
prepare is</p>
<ol class="arabic simple">
<li>Process prepare input parameters.  Note that the input parameters for
prepare are related to the calculation&#8217;s input parameters, but are not
typically identical.</li>
<li>Access a database and build a list of all existing calculation records
associated with the calculation being prepared.</li>
<li>Generate (meaningful) combinations of calculation input parameters based on
the prepare input parameters.</li>
<li>Compare each generated combination of parameters to the list of existing
calculation records.  If the combination is new (i.e. no match found), do
the remaining steps.</li>
<li>Create a calculation instance folder in a specified &#8216;run_directory&#8217;.</li>
<li>Build an input parameter file based on the combination of parameters and
save it within the instance folder.</li>
<li>Copy all other required files including the calculation script to the
instance folder.</li>
<li>Build a new calculation record based on the combination of parameters and
upload it to the database.</li>
</ol>
<div class="section" id="functions-of-the-prepare-script">
<h2>Functions of the prepare script<a class="headerlink" href="#functions-of-the-prepare-script" title="Permalink to this headline">¶</a></h2>
<p>Each prepare script has five primary functions:</p>
<ul>
<li><p class="first">main() function called when the script is executed directly.  This reads in
a given input parameter file, converts it into input_dict dictionary,
generates dbase and run_directory arguments from input terms, and calls:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">prepare</span><span class="p">(</span><span class="n">dbase</span><span class="p">,</span> <span class="n">run_directory</span><span class="p">,</span> <span class="o">**</span><span class="n">input_dict</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">prepare() function that prepares instances of the calculation. See the next
section for more detailed information.</p>
</li>
<li><p class="first">unusedkeys() function returns a list of input parameter names for the
calculation that are not interpreted by the prepare.  These tend to be
parameters in which alternate calculation parameters provide the same
information, or are automatically generated by alternate prepare parameters.</p>
</li>
<li><p class="first">singularkeys() function returns a list of input parameter names for the
prepare that are restricted from having multiple values.</p>
</li>
<li><p class="first">multikeys() function returns a list of input parameter names for the prepare
that can have multiple values.</p>
</li>
</ul>
</div>
<div class="section" id="the-prepare-function">
<h2>The prepare() function<a class="headerlink" href="#the-prepare-function" title="Permalink to this headline">¶</a></h2>
<p>Each calculation&#8217;s prepare function takes two required arguments:</p>
<ul class="simple">
<li><em>dbase</em> is an iprPy.Database object associated with the database to access.</li>
<li><em>run_directory</em> is a str specifying the path to the directory where the
prepared calculation instances are placed.</li>
</ul>
<p>All other arguments are keyword arguments corresponding to the prepare&#8217;s input
parameters.  The singularkeys() and multikeys() functions provide lists of the
supported parameters. Defining prepare() functions in this way makes them
compatible with the iprPy.Calculation.prepare() method and the iprPy prepare
line command.</p>
<p>There are two main challenges that drive the design and structure of the
prepare functions:</p>
<ol class="arabic">
<li><p class="first">Both calculation input parameters and meaningful combinations of such are
distinct for every calculation.  This means that each calculation is
required to have its own unique prepare function.  Luckily, most of what
the prepare functions do is similar making it convenient to create new
prepare functions by modifying existing ones.  In doing so, the main
consideration is related to specifying the proper way of iterating over
parameters (which ones are independent, paired, etc.).</p>
<p>Note: the similarity of code across calculations suggests that there is
good opportunity to define new functions in the iprPy.prepare submodule to
simplify the prepare functions.</p>
</li>
<li><p class="first">Determining if a combination of parameters is new can be tricky because the
comparisons require the parameters to be processed (default values
assigned, reference files processed, etc.).  Ideally, the parameters should
be processed by the exact same functions as those used when the calculation
is performed to ensure compatibility.  However, there are important
differences between the parameters being generated by the prepare function
and the parameters used to run a calculation.</p>
<p>The first step of processing a parameter combination is to generate an
input_dict dictionary of input parameters for the calculation.  For the most
part, the dictionary keys directly correspond to the parameters allowed by a
calculation&#8217;s input parameter file.  However, additional terms can also be
included that are important during prepare but not allowed when the
calculation is executed.</p>
<p>This ability is important when it comes to specifying reference files and
records as parameters.  These reference files are typically copied to each
calculation instance that uses them, and the input parameters give their
relative location.  The problem during preparation of the calculation is
that the instance, and the associated files, do not actually exist at the
time that the input parameters are processed.  To get around this, each
*_file parameter that specifies a reference file name (i.e. load_file,
potential_file) has a corresponding *_content parameter in which the
contents of the reference file can be saved.  Thus, the contents of a
reference file can be included in the processing before the file actually
exists.</p>
<p>The terms in input_dict are then directly processed by the calculation&#8217;s
process_input() function by using the iprPy.Calculation.process_input()
method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">calculation</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">Calculation</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">calc_style</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">calculation</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">calc_key</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>It is important to note the build argument in this function call.  With
build=False, complex, derived inputs that are only important when the
calculation is executed (such as initial atomic configurations) will not be
constructed.  This not only saves processing time, but it also allows for
calculations to be prepared based on reference records that are not yet
complete.</p>
<p>Finally, a Record is constructed based on the processed input_dict:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">buildmodel</span><span class="p">(</span><span class="n">record_style</span><span class="p">,</span> <span class="n">calc_style</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">)</span>
<span class="n">new_record</span> <span class="o">=</span> <span class="n">iprPy</span><span class="o">.</span><span class="n">Record</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">calc_key</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">xml</span><span class="p">(),</span> <span class="n">style</span><span class="o">=</span><span class="n">record_style</span><span class="p">)</span>
</pre></div>
</div>
<p>This Record object can then easily be compared to the list of existing
records using the Record.isnew() method.</p>
</li>
</ol>
</div>
<div class="section" id="functions-of-iprpy-prepare-submodule">
<h2>Functions of iprPy.prepare submodule<a class="headerlink" href="#functions-of-iprpy-prepare-submodule" title="Permalink to this headline">¶</a></h2>
<p>The iprPy.prepare submodule defines functions that can assist in common handling of prepare functions across different calculations.  This section gives a brief description on a few of these functions, which are focused on calculations that use the atomman package for performing LAMMPS simulations.  For more details and a complete list of the functions, see the iprPy.prepare documentation.</p>
<p><strong>ipotentials()</strong> iteratively yields all potential_LAMMPS records within a database that match  specified delimiting conditions.</p>
<p><strong>iprototypes()</strong> iteratively yields all crystal_prototype records within a database that match  specified delimiting conditions.</p>
<p><strong>icalculations()</strong> iteratively yields all calculation records of a specified record style within a database that match  specified delimiting conditions.</p>
<p><strong>isymbolscombos()</strong> given a crystal_prototype record and potential_LAMMPS record, this function iterates over all combinations of the potential&#8217;s element model symbols and the prototype&#8217;s unique atomic sites.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction to iprPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">iprPy Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../highthroughput/index.html">High-Throughput Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Adding Content to iprPy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="add_potential.html">Adding new potentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_parameter_record.html">Adding new library parameter records</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_calculation_style.html">Creating Calculation Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="calc_atomman.html">LAMMPS Calculations Using atomman</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Generating a Prepare Script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions-of-the-prepare-script">Functions of the prepare script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-prepare-function">The prepare() function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-of-iprpy-prepare-submodule">Functions of iprPy.prepare submodule</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="add_record_style.html">Constructing Record Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_database_style.html">Constructing Database Styles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calculation_styles.html">Calculation Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../record_styles.html">Record Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database_styles.html">Database Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">iprPy</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="calc_atomman.html" title="LAMMPS Calculations Using atomman"
              >previous</a> |
            <a href="add_record_style.html" title="Constructing Record Styles"
              >next</a> |
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/extend/calc_prepare.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Lucas Hale.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>