<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Runner &#8212; iprPy 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Other High-Throughput Tools" href="inline.html" />
    <link rel="prev" title="Prepare" href="prepare.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">iprPy 0.7.2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="prepare.html" title="Prepare"
             accesskey="P">previous</a> |
          <a href="inline.html" title="Other High-Throughput Tools"
             accesskey="N">next</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="runner">
<h1>Runner<a class="headerlink" href="#runner" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Prepared calculations can be systematically executed by starting one or more
runners. Each runner operates over a single run_directory and database.</p>
</div>
<div class="section" id="starting-runners">
<h2>Starting runners<a class="headerlink" href="#starting-runners" title="Permalink to this headline">¶</a></h2>
<p>There are multiple ways that a runner can be started.  <strong>Note</strong>: With all of
these methods, do <em>not</em> start the runner using an MPI command!  If a
calculation is to use multiprocessing, it should be specified by parameters in
the calculation’s input file.</p>
<div class="section" id="runner-script">
<h3>Runner script<a class="headerlink" href="#runner-script" title="Permalink to this headline">¶</a></h3>
<p>The runner.py script in the iprPy/highthroughput folder/module can be executed
directly as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">runner</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">runner</span><span class="o">.</span><span class="ow">in</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">runner</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">runner</span><span class="o">.</span><span class="ow">in</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where &lt;runner.in&gt; is the name/path for an input parameter file used by the
runner. The runner’s input file should only specify a “run_directory” term, a
“database” term and any “database_*” access terms necessary to define the
run_directory and database to interact with.</p>
</div>
<div class="section" id="inline-command">
<h3>Inline command<a class="headerlink" href="#inline-command" title="Permalink to this headline">¶</a></h3>
<p>A runner can be started by entering iprPy’s bin directory and using the inline
terminal command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">iprPy</span> <span class="n">runner</span> <span class="o">&lt;</span><span class="n">database</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">run_directory</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where &lt;database&gt; and &lt;run_directory&gt; are the names associated with a database
and a run_directory that have been set using the iprPy set inline command.</p>
</div>
<div class="section" id="call-from-python">
<h3>Call from Python<a class="headerlink" href="#call-from-python" title="Permalink to this headline">¶</a></h3>
<p>A runner can be started from a Python script or a Jupyter Notebook by
calling:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">iprPy</span><span class="o">.</span><span class="n">highthroughput</span><span class="o">.</span><span class="n">runner</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dbase</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">run_directory</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>where &lt;dbase&gt; is an iprPy.Database object, and &lt;run_directory&gt; is the string
path to the run_directory to use.</p>
</div>
<div class="section" id="submitting-to-a-queue">
<h3>Submitting to a queue<a class="headerlink" href="#submitting-to-a-queue" title="Permalink to this headline">¶</a></h3>
<p>The bin/ directory of iprPy also contains simple example bash scripts that
can be used for submitting jobs to a queue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">submission_command</span><span class="o">&gt;</span> <span class="n">iprPy_runner</span> <span class="o">&lt;</span><span class="n">runner</span><span class="o">.</span><span class="ow">in</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">submission_command</span><span class="o">&gt;</span> <span class="n">iprPy_script</span> <span class="n">runner</span> <span class="o">&lt;</span><span class="n">database</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">run_directory</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The difference between these two is that iprPy_runner uses the runner.py
script, whereas iprPy_script uses the iprPy inline command. The advantage of
iprPy_script is that it can take advantage of the pre-defined databases and
run_directories, and can be used to submit other high-throughput commands as
jobs.</p>
<p><strong>Note</strong>: The &lt;submission_command&gt; should specify the number of cores assigned
to the runner. To be most efficient, this should correspond to the number of
cores that the calculation instances in the run_directory will try to use (as
specified in the instances’ input files).</p>
</div>
</div>
<div class="section" id="full-process">
<h2>Full process<a class="headerlink" href="#full-process" title="Permalink to this headline">¶</a></h2>
<p>This is a full description of the process that a runner uses:</p>
<ol class="arabic simple">
<li>A calculation folder in the run_directory is selected at random.</li>
<li>The runner attempts to bid on the calculation instance. This step is done
to help ensure that only one runner operates on any calculation instance.<ol class="upperalpha">
<li>If the calculation folder already contains a *.bid file, then the bid
fails.</li>
<li>The runner creates a *.bid file using the runner’s pid number.</li>
<li>After waiting one second, the runner checks all *.bid files in the
folder. If the runner’s pid corresponds to the minimum *.bid, then the
bid succeeds. Otherwise it fails.</li>
</ol>
</li>
<li>If the bid is successful, it checks all files in the calculation instance’s
folder. For any XML or JSON records, it checks for a “status” element.<ol class="upperalpha">
<li>“status” == “not calculated” indicates that a necessary parent
calculation had not been performed at the time that the current
calculation instance was prepared. The runner will update the record
with the database’s copy. If “status” is still “not calculated”, the
runner will remove its bid from the current calculation instance and
try to bid on the parent calculation instance.</li>
<li>“status” == “error” indicates that a necessary parent calculation
failed. The current calculation instance will raise an error to reflect
this.</li>
</ol>
</li>
<li>The calculation instance is checked to ensure that it is valid and
complete. The folder must contain exactly one each of calc_*.py and
calc_*.in files, and there must be a corresponding record in the database.
If not, the calculation instance is moved to an orphan directory.</li>
<li>The calculation instance is executed as a subprocess by running the
identified calc_*.py script and passing it the calc_*.in file and the
calculation instance’s unique key as arguments.</li>
<li>If the calculation successfully finishes, then the generated results.json
file is uploaded to the database.</li>
<li>If the calculation issues an error, then the record for the calculation
instance is updated by changing “status” to “error” and saving the Python
error message to an “error” element.</li>
<li>The folder for the finished calculation instance is archived as a .tar.gz
file and uploaded to the database. The calculation instance is deleted from
the run_directory, with the *.bid file being deleted last to help prevent
runner collisions.</li>
<li>Steps 1-8 are repeated until either the run_directory is empty or the
runner fails ten bids in a row.</li>
</ol>
</div>
<div class="section" id="runner-log-files">
<h2>Runner log files<a class="headerlink" href="#runner-log-files" title="Permalink to this headline">¶</a></h2>
<p>When a runner is started, it will create a .log file in the runner-logs/
directory of iprPy. Each runner log file will be uniquely named based on the
date and time that the runner was started. As the runner proceeds, it will
append information to the log file, flushing after each line to ensure that
the log files are up to date. The information listed in the log file includes:</p>
<ul class="simple">
<li>The key for any calculation instance that the runner succeeds at bidding
for.</li>
<li>Information about if any parent records needed to be updated or if any
parent calculation instances needed to be performed.</li>
<li>A message if the calculation instance was successful, moved to the orphan
directory, or issued an error. For the errors, the corresponding Python
error message is also added.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction to iprPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">iprPy Basics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">High-Throughput Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="classes.html">iprPy Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare.html">Prepare</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Runner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-runners">Starting runners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#runner-script">Runner script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inline-command">Inline command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#call-from-python">Call from Python</a></li>
<li class="toctree-l4"><a class="reference internal" href="#submitting-to-a-queue">Submitting to a queue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#full-process">Full process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runner-log-files">Runner log files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inline.html">Other High-Throughput Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extend/index.html">Adding Content to iprPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calculation_styles.html">Calculation Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../record_styles.html">Record Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database_styles.html">Database Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">iprPy</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="prepare.html" title="Prepare"
              >previous</a> |
            <a href="inline.html" title="Other High-Throughput Tools"
              >next</a> |
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/highthroughput/runner.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Lucas Hale.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>